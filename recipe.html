<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Discover healthy recipes that are quick, affordable, and delicious."
    />

    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/images/favicon-32x32.png"
    />

    <title>Frontend Mentor | Recipe finder website</title>
    <link rel="stylesheet" href="./output.css" />
  </head>
  <body>
    <!-- ================= HEADER ================= -->
    <header id="header"></header>

    <main class="pt-[72px] md:pt-[93px]">
      <!-- ================= RECIPE DETAILS ================= -->
      <section id="recipeDetails" class="py-12 lg:py-16"></section>

      <!-- Divider -->
      <div class="border-t-[1px] border-t-neutral-200"></div>

      <!-- ================= MORE RECIPES ================= -->
      <section class="py-12 md:py-16">
        <h2 class="text-preset-3 mb-6">More recipes</h2>
        <div
          id="moreRecipes"
          class="grid gap-8 lg:grid-cols-2 xl:grid-cols-3"
        ></div>
      </section>
    </main>

    <!-- ================= FOOTER ================= -->
    <footer id="footer" class="border-t-[1px] border-t-neutral-200"></footer>

    <!-- ================= SCRIPT ================= -->
    <script type="module">
      import { initPage, renderRecipeCard } from "./js/components.js";
      import { initMenu } from "./js/main.js";

      initPage("recipes");
      initMenu();

      // Recipe details rendering
      const recipeSection = document.getElementById("recipeDetails");
      const moreRecipesSection = document.getElementById("moreRecipes");

      function getSlug() {
        const params = new URLSearchParams(window.location.search);
        return params.get("slug");
      }

      function renderRecipe(recipe) {
        recipeSection.innerHTML = `
          <nav class="text-preset-7 mb-4">
            <a href="./recipes.html" class=" opacity-60 hover:underline">Recipes</a> /
            <span> ${recipe.title}</span>
          </nav>
          <div class="grid gap-10 lg:grid-cols-2 items-start">
            <picture>
              <source media="(min-width: 1024px)" srcset="${
                recipe.image.large
              }" />
              <img src="${recipe.image.small}" alt="${
          recipe.title
        }" loading="lazy"
                   class="w-full rounded-[10px] object-cover lg:max-w-xl lg:max-h-xl" />
            </picture>

            <div class="space-y-5">
              <h1 class="text-preset-2">${recipe.title}</h1>
              <p>${recipe.overview}</p>
              <ul class="text-preset-7 grid grid-cols-2 gap-x-4 gap-y-2 items-start w-fit md:grid-cols-3">
                <li class="flex items-center gap-1.5">
                    <img src="./assets/images/icon-servings.svg" alt="" aria-hidden="true" />
                    Servings: ${recipe.servings}
                  </li>
                  <li class="flex items-center gap-1.5">
                    <img src="./assets/images/icon-prep-time.svg" alt="" aria-hidden="true" />
                    Prep: ${recipe.prepMinutes} mins
                  </li>
                  <li class="flex items-center gap-1.5">
                    <img src="./assets/images/icon-cook-time.svg" alt="" aria-hidden="true" />
                    Cook: ${recipe.cookMinutes} mins
                  </li>
              </ul>

              <div>
                <h2 class="text-preset-4 mb-4">Ingredients:</h2>
                <ul class="space-y-2">
                  ${recipe.ingredients
                    .map(
                      (i) => `<li class="flex items-center gap-2">
                          <img src="./assets/images/icon-bullet-point.svg" alt="" class="w-6 h-6"/>
                          <span >${i}</span>  
                        </li>`
                    )
                    .join("")}
                </ul>
              </div>


              <div>
                <h2 class="text-preset-4 mb-4">Instructions:</h2>
                <ul class="space-y-2">
                  ${recipe.instructions
                    .map(
                      (i) =>
                        `<li class="flex items-center gap-2">
                          <img src="./assets/images/icon-bullet-point.svg" alt="" class="w-6 h-6"/>
                          <p >${i}</p>  
                        </li>`
                    )
                    .join("")}
                </ul>
              </div>
            </div>
          </div>
        `;
      }

      function renderMoreRecipes(all, currentSlug) {
        const others = all.filter((r) => r.slug !== currentSlug);
        const randomThree = others.sort(() => 0.5 - Math.random()).slice(0, 3);
        moreRecipesSection.innerHTML = "";
        randomThree.forEach((r) => {
          const card = renderRecipeCard(r);
          moreRecipesSection.appendChild(card);
        });
      }

      async function loadRecipe() {
        const slug = getSlug();
        if (!slug) return;
        const res = await fetch("./data.json");
        const allRecipes = await res.json();
        const recipe = allRecipes.find((r) => r.slug === slug);
        if (recipe) {
          renderRecipe(recipe);
          renderMoreRecipes(allRecipes, slug);
        }
      }

      loadRecipe();
    </script>
  </body>
</html>
